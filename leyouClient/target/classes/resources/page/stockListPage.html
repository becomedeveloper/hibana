<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>å•†å“åˆ—è¡¨</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        $(function () {
            getStockList();
        })
        function getStockList() {
            $.ajax({
                type:'post',
                url:"/leyouStock/getStockList",
                success:function(data){
                    if (data.sku_list){
                        $(data.sku_list).each(function (n,value) {
                            //console.log(JSON.stringify(value));
                            var stockDetailClone = $(".stockDetailClone").clone();
                            stockDetailClone.addClass("stockDetail");
                            stockDetailClone.removeClass("stockDetailClone");
                            stockDetailClone.css("display","block");
                            stockDetailClone.find(".stockImage").attr("src",value.images);
                            stockDetailClone.find(".stockName").html(value.title);
                            //ç§’æ€ä»·æ ¼
                            var limitPrice = value.limitPrice;
                            var newStockPrice = value.price;
                            //å­˜åœ¨ç§’æ€æ”¿ç­–
                            if (limitPrice){
                                stockDetailClone.find(".oldStockPrice").html("ï¿?"+parseInt(value.price)/100);
                                newStockPrice = limitPrice;
                                lasttime(value.limitEndTime,stockDetailClone);
                            }else {
                                stockDetailClone.find(".oldStockPrice").remove();
                                stockDetailClone.find(".time").html("");
                            }
                            stockDetailClone.find(".newStockPrice").html(parseInt(newStockPrice)/100);
                            stockDetailClone.attr("sku_id",value.sku_id);
                            $("#stockList").append(stockDetailClone);
                        })
                    }
                },error:function(){
                    alert("è¯·æ±‚å‡ºé”™ï¼Œè?·ç¨åé‡è¯?");
                }
            });
        }

        /**
         * ç«‹å³æŠ¢è´­
         * @param obj
         */
        function goStockDetail(obj) {
            var sku_id = $(obj).attr("sku_id");
            if (!sku_id){
                alert("å•†å“ID=ã€?"+sku_id+"ã€?");
            }
            //è·³è½¬å•†å“è¯¦æƒ…é¡?
            open("stockDetailPage.html?sku_id="+sku_id);
        }

        //åˆå?‹åŒ–æ´»åŠ¨å‰©ä½™æ—¶é—´
        function lasttime(limitPriceTime,htmlObj){
            var stopTime = (new Date(limitPriceTime).getTime() - new Date().getTime())/1000;//ç§’æ€ç»“æŸæ—¶é—´
            setInterval(function(){
                if (stopTime<0){
                    htmlObj.find(".time").html("ç§’æ€æ´»åŠ¨å·²ç»“æŸï¼");
                    return;
                }
                //å¤? å°æ—¶ åˆ? ç§?
                var days = Math.floor(stopTime/(24*3600));
                var hours =Math.floor(stopTime%(24*3600)/3600);
                var minutes = Math.floor(stopTime%3600/60);
                var seconds = Math.floor(stopTime%60);
                days = days<10?"0"+days:days;
                hours = hours<10?"0"+hours:hours;
                minutes = minutes<10?"0"+minutes:minutes;
                seconds = seconds<10?"0"+seconds:seconds;
                htmlObj.find(".time").find(".days").html(days);
                htmlObj.find(".time").find(".hours").html(hours);
                htmlObj.find(".time").find(".minutes").html(minutes);
                htmlObj.find(".time").find(".seconds").html(seconds);
                stopTime--;
            },1000);
        }
    </script>
    <style type="text/css">
        .stockDetail{
            float: left;
        }
        .time{
            line-height: 20px;
            height: 20px;
            width: 100%;
        }
        .stockName{
            width: 300px;
        }
    </style>
</head>
<body>
    <div style='padding-top: 20px;'>
        <div>
            <img src="../resources/img/leyouStockList.png" style="width: 100%">
        </div>
        <div id="stockList" class="input-group input-group-lg" style="margin-bottom: 20px;margin-right: auto;margin-left: auto;width: 1200px;">
            <div onclick="goStockDetail(this);" spu_id="" class="stockDetailClone" style="display: none;position: relative; width: 400px;">
                <div>
                    <img style="margin-left: auto;margin-right: auto;display: block; cursor: pointer;" class="stockImage"
                         width="300" src="https://img12.360buyimg.com/mobilecms/s500x500_jfs/t1/39975/12/13078/78268/5d428ed3Ecb07159d/e03e34e6130c8df9.jpg">
                </div>
                <div class="stockName">

                </div>
                <div class="stockPrice">
                    <span style="font-size: 18px;color: #d21e20;">ï¿?<span class="newStockPrice">12345</span></span>
                    <span style="font-size: 14px;text-decoration:line-through;color: #888888;" class="oldStockPrice">ï¿?23456</span>
                </div>
                <div class="time">
                    <span>æŠ¢è´­å€’è?¡æ—¶ï¼?</span>
                    <span class="countDown days">00</span>
                    <span>å¤?</span>
                    <span class="countDown hours">00</span>
                    <span>æ—?</span>
                    <span class="countDown minutes">00</span>
                    <span>åˆ?</span>
                    <span class="countDown seconds">00</span>
                    <span>ç§?</span>
                </div>
            </div>
        </div>
    </div>
</body>
</html>